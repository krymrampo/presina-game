<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presina - Gioco di Carte Online</title>
    <link rel="stylesheet" href="/static/css/style.css?v=20260201d">
    <link rel="stylesheet" href="/static/css/auth.css?v=20260201a">
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>
    <div id="app">
        <!-- HOME SCREEN -->
        <div id="home-screen" class="screen active">
            <div class="home-container">
                <img class="home-logo" src="/static/img/logo.png" alt="Presina">
                <p class="subtitle">poche regole, molto ragionamento</p>
                
                <div id="home-not-logged">
                    <div class="home-auth">
                        <h3 class="auth-title">Accedi o registrati</h3>
                        <div class="auth-tabs">
                        <button class="auth-tab active" data-tab="login">Accedi</button>
                        <button class="auth-tab" data-tab="register">Registrati</button>
                        </div>
                    
                        <div id="login-form" class="auth-form active">
                        <div class="input-group">
                            <label for="login-username">Username</label>
                            <input type="text" id="login-username" maxlength="20" placeholder="Il tuo username">
                        </div>
                        <div class="input-group">
                            <label for="login-password">Password</label>
                            <input type="password" id="login-password" maxlength="50" placeholder="La tua password">
                        </div>
                        <button id="btn-login" class="btn btn-primary">Accedi</button>
                        </div>
                    
                        <div id="register-form" class="auth-form">
                        <div class="input-group">
                            <label for="register-username">Username</label>
                            <input type="text" id="register-username" maxlength="20" placeholder="Scegli uno username">
                        </div>
                        <div class="input-group">
                            <label for="register-display-name">Nome visualizzato</label>
                            <input type="text" id="register-display-name" maxlength="20" placeholder="Come ti vedranno in gioco">
                        </div>
                        <div class="input-group">
                            <label for="register-password">Password</label>
                            <input type="password" id="register-password" maxlength="50" placeholder="Crea una password">
                        </div>
                        <button id="btn-register" class="btn btn-primary">Crea account</button>
                        </div>
                    </div>
                    
                    <div class="guest-section">
                        <div class="divider">oppure</div>
                        <div class="input-group">
                            <label for="player-name">Nome ospite:</label>
                            <input type="text" id="player-name" maxlength="20" placeholder="Inserisci il tuo nome...">
                        </div>
                        <button id="btn-guest" class="btn btn-secondary">Gioca come ospite</button>
                    </div>
                </div>
                
                <div id="home-logged" class="hidden">
                    <div class="user-welcome">
                        <h3 id="user-display-name">Ciao!</h3>
                        <p id="user-username" class="hidden">@utente</p>
                    </div>
                    
                    <div class="button-group">
                        <button id="btn-enter-lobby" class="btn btn-primary">Entra nella Lobby</button>
                        <button id="btn-profile" class="btn btn-secondary hidden">üë§ Profilo</button>
                        <button id="btn-logout" class="btn btn-secondary">Esci</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- PROFILE SCREEN -->
        <div id="profile-screen" class="screen">
            <div class="profile-container">
                <div class="profile-header">
                    <button id="btn-back-profile" class="btn-back">‚Üê</button>
                    <h2>Profilo</h2>
                </div>
                
                <div class="profile-card">
                    <div class="profile-avatar-container">
                        <img id="profile-avatar-img" class="profile-avatar-img" src="/static/img/logo.png" alt="Avatar">
                        <label for="avatar-upload-input" class="avatar-upload-btn">üì∑</label>
                        <input id="avatar-upload-input" type="file" accept="image/*" class="hidden">
                    </div>
                    <div class="profile-display-name-row">
                        <h3 id="profile-display-name">Giocatore</h3>
                        <button id="btn-edit-display-name" class="btn btn-secondary btn-small">Modifica</button>
                    </div>
                    <div id="display-name-editor" class="display-name-editor hidden">
                        <input id="display-name-input" type="text" maxlength="20" placeholder="Nome visualizzato">
                        <button id="btn-save-display-name" class="btn btn-primary btn-small">Salva</button>
                        <button id="btn-cancel-display-name" class="btn btn-secondary btn-small">Annulla</button>
                    </div>
                    <p id="profile-username">@utente</p>
                    <span id="profile-member-since" class="member-since"></span>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <span id="profile-stat-games" class="stat-value">0</span>
                        <span class="stat-label">Partite</span>
                    </div>
                    <div class="stat-card">
                        <span id="profile-stat-wins" class="stat-value">0</span>
                        <span class="stat-label">Vittorie</span>
                    </div>
                    <div class="stat-card">
                        <span id="profile-stat-losses" class="stat-value">0</span>
                        <span class="stat-label">Sconfitte</span>
                    </div>
                    <div class="stat-card">
                        <span id="profile-stat-winrate" class="stat-value">0%</span>
                        <span class="stat-label">Win rate</span>
                    </div>
                    <div class="stat-card">
                        <span id="profile-stat-lives" class="stat-value">0</span>
                        <span class="stat-label">Vite perse</span>
                    </div>
                    <div class="stat-card">
                        <span id="profile-stat-streak" class="stat-value">0</span>
                        <span class="stat-label">Miglior streak</span>
                    </div>
                </div>
                
                <div class="profile-section">
                    <h4>üïë Ultime partite</h4>
                    <div id="profile-game-history" class="game-history"></div>
                </div>
                
                <div class="profile-section">
                    <h4>üèÜ Classifica</h4>
                    <div class="leaderboard-tabs">
                        <button class="lb-tab active" data-cat="wins">Vittorie</button>
                        <button class="lb-tab" data-cat="win_rate">Win rate</button>
                        <button class="lb-tab" data-cat="streak">Streak</button>
                    </div>
                    <div id="profile-leaderboard" class="leaderboard"></div>
                </div>
                
                <div class="profile-actions">
                    <button id="btn-logout-profile" class="btn btn-secondary">Esci</button>
                    <button id="btn-back-home-profile" class="btn btn-primary">Torna Home</button>
                </div>
            </div>
        </div>

        <!-- LOBBY SCREEN -->
        <div id="lobby-screen" class="screen">
            <div class="lobby-container">
                <div class="lobby-header">
                    <h2>üè† Lobby</h2>
                    <span id="player-name-display" class="player-badge"></span>
                </div>
                
                <div id="existing-room-banner" class="banner hidden">
                    <span>Sei gi√† in una stanza!</span>
                    <div class="banner-actions">
                        <button id="btn-rejoin" class="btn btn-small">Rientra</button>
                        <button id="btn-abandon" class="btn btn-small btn-secondary">Abbandona</button>
                    </div>
                </div>
                
                <div class="lobby-actions">
                    <div class="search-box">
                        <input type="text" id="room-search" placeholder="Cerca stanza...">
                        <button id="btn-search" class="btn btn-small">üîç</button>
                    </div>
                    <button id="btn-create-room" class="btn btn-primary">+ Crea Stanza</button>
                </div>
                
                <div id="rooms-list" class="rooms-list">
                    <p class="empty-message">Nessuna stanza disponibile. Creane una!</p>
                </div>
                
                <button id="btn-back-home-lobby" class="btn btn-secondary">‚Üê Torna alla Home</button>
            </div>
            
            <!-- Create Room Modal -->
            <div id="create-room-modal" class="modal hidden">
                <div class="modal-content">
                    <h3>Crea Nuova Stanza</h3>
                    <div class="input-group">
                        <label for="room-name">Nome stanza:</label>
                        <input type="text" id="room-name" maxlength="30" placeholder="Nome della stanza...">
                    </div>
                    <div class="input-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="room-private-check">
                            <span>üîí Stanza privata (richiede codice)</span>
                        </label>
                    </div>
                    <div id="room-code-group" class="input-group hidden">
                        <label for="room-access-code">Codice di accesso:</label>
                        <input type="text" id="room-access-code" maxlength="10" placeholder="Inserisci un codice...">
                        <p class="hint-text">Condividi questo codice solo con chi vuoi invitare</p>
                    </div>
                    <div class="button-group">
                        <button id="btn-confirm-create" class="btn btn-primary">Crea</button>
                        <button id="btn-cancel-create" class="btn btn-secondary">Annulla</button>
                    </div>
                </div>
            </div>
            
            <!-- Join Private Room Modal -->
            <div id="join-private-modal" class="modal hidden">
                <div class="modal-content">
                    <h3>üîí Stanza Privata</h3>
                    <p>Questa stanza richiede un codice di accesso.</p>
                    <div class="input-group">
                        <label for="join-access-code">Codice:</label>
                        <input type="text" id="join-access-code" maxlength="10" placeholder="Inserisci il codice...">
                    </div>
                    <div class="button-group">
                        <button id="btn-confirm-join-private" class="btn btn-primary">Entra</button>
                        <button id="btn-cancel-join-private" class="btn btn-secondary">Annulla</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- WAITING ROOM SCREEN -->
        <div id="waiting-room-screen" class="screen">
            <div class="waiting-container">
                <div class="room-header">
                    <h2 id="room-title">Stanza</h2>
                    <span id="room-status" class="status-badge">In attesa</span>
                </div>
                
                <div id="waiting-players" class="players-grid">
                    <!-- Players will be rendered here -->
                </div>
                
                <div id="admin-controls" class="admin-controls hidden">
                    <button id="btn-start-game" class="btn btn-primary btn-large">‚ñ∂ Avvia Partita</button>
                    <p class="hint">Servono almeno 2 giocatori</p>
                    <div id="room-code-display" class="room-code-display hidden">
                        <span>üîí Codice: <strong id="display-access-code"></strong></span>
                        <p class="hint">Condividi questo codice per invitare</p>
                    </div>
                </div>
                
                <div class="waiting-actions">
                    <button id="btn-leave-room" class="btn btn-secondary">üö™ Abbandona</button>
                </div>
                
                <!-- Chat in waiting room -->
                <div class="waiting-chat">
                    <div id="waiting-chat-messages" class="chat-messages"></div>
                    <div class="chat-input-area">
                        <input type="text" id="waiting-chat-input" maxlength="200" placeholder="Scrivi un messaggio...">
                        <button id="btn-send-waiting-chat" class="btn btn-small">Invia</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- GAME SCREEN -->
        <div id="game-screen" class="screen">
            <div class="game-container">
                <!-- Header -->
                <div class="game-header">
                    <div class="turn-info">
                        <span id="turn-number">Turno 1/5</span>
                        <span id="cards-info">5 carte</span>
                        <span id="trick-info" class="trick-info-header">Mano 1/5</span>
                    </div>
                    <div id="phase-indicator" class="phase-indicator">Puntate</div>
                </div>
                
                <!-- Spectator/Join Banner -->
                <div id="spectator-banner" class="banner hidden">
                    <span>üëÅÔ∏è Sei spettatore. Giocherai dal prossimo turno.</span>
                </div>
                
                <!-- Main Game Area -->
                <div class="game-main">
                    <!-- Left Panel: Hand & Betting -->
                    <div class="hand-panel">
                        <h3>Le tue carte</h3>
                        <div id="player-hand" class="hand-area">
                            <!-- Cards will be rendered here -->
                        </div>
                        
                        <!-- Betting Area (moved here) -->
                        <div id="betting-area" class="betting-area hidden">
                            <h4>Fai la tua puntata</h4>
                            <div id="bet-buttons" class="bet-buttons">
                                <!-- Bet buttons rendered by JS -->
                            </div>
                            <p id="forbidden-bet-note" class="forbidden-note hidden"></p>
                        </div>
                        
                        <!-- Bets Summary (visible during betting phase) -->
                        <div id="bets-summary" class="bets-summary hidden">
                            <h4>Puntate</h4>
                            <div id="bets-list" class="bets-list">
                                <!-- Bets rendered here -->
                            </div>
                        </div>
                        
                        <div id="special-turn-note" class="special-note hidden">
                            ‚ö†Ô∏è Turno speciale: vedi le carte degli altri, non le tue!
                        </div>
                        <div id="others-cards" class="others-cards hidden">
                            <!-- Other players' cards in special turn -->
                        </div>
                    </div>
                    
                    <!-- Center: Table -->
                    <div class="table-area">
                        <div id="table-center" class="table-center">
                            <div id="played-cards" class="played-cards">
                                <!-- Played cards go here -->
                            </div>
                        </div>
                        
                        <!-- Player positions around table -->
                        <div id="table-positions" class="table-positions">
                            <!-- 8 player slots rendered by JS -->
                        </div>
                    </div>
                    
                    <!-- Right Panel removed (players list now on table) -->
                </div>
                
                <!-- Table Bets Overlay (visible during betting phase) -->
                <div id="table-bets-overlay" class="table-bets-overlay hidden">
                    <h3>Puntate in corso...</h3>
                    <div id="table-bets-list" class="table-bets-list">
                        <!-- Bets displayed here -->
                    </div>
                </div>
                
                <!-- Jolly Choice -->
                <div id="jolly-choice" class="jolly-choice hidden">
                    <img class="jolly-logo" src="/static/img/logo.png" alt="Presina">
                    <p class="jolly-subtitle">poche regole, molto ragionamento</p>
                    <p class="jolly-instruction">Scegli come usarlo:</p>
                    <div class="jolly-buttons">
                        <button id="btn-jolly-prende" class="btn btn-primary">üí™ Prende (Pi√π Forte)</button>
                        <button id="btn-jolly-lascia" class="btn btn-secondary">ü™∂ Lascia (Pi√π Debole)</button>
                    </div>
                </div>
                
                <!-- Trick Winner Popup -->
                <div id="trick-winner-overlay" class="trick-winner-overlay"></div>
                <div id="trick-winner-popup" class="trick-winner-popup">
                    <div class="trick-winner-content">
                        <div class="trick-winner-icon">üèÜ</div>
                        <h3>Mano Vinta!</h3>
                        <p id="trick-winner-name">Giocatore</p>
                        <p id="trick-winner-card" class="trick-winner-card">con la carta</p>
                    </div>
                </div>
                
                <!-- Turn Results -->
                <div id="turn-results" class="turn-results hidden">
                    <h3>Risultati del Turno</h3>
                    <div class="results-table-wrap">
                        <table class="results-table" aria-label="Risultati del turno">
                            <thead>
                                <tr>
                                    <th class="col-name">Giocatore</th>
                                    <th class="col-bet">Puntata</th>
                                    <th class="col-won">Prese</th>
                                    <th class="col-result">Esito</th>
                                    <th class="col-lives">Vite</th>
                                </tr>
                            </thead>
                            <tbody id="results-list"></tbody>
                        </table>
                    </div>
                    <button id="btn-next-turn" class="btn btn-primary">Prossimo Turno</button>
                    <div id="ready-count" class="ready-count">Pronti: 0/0</div>
                </div>
                
                <!-- Card Confirm Popup -->
                <div id="card-confirm-overlay" class="card-confirm-overlay hidden"></div>
                <div id="card-confirm" class="card-confirm hidden">
                    <p>Conferma carta: <span id="selected-card-name"></span></p>
                    <div class="button-group">
                        <button id="btn-confirm-card" class="btn btn-primary">‚úì Gioca</button>
                        <button id="btn-cancel-card" class="btn btn-secondary">‚úó Annulla</button>
                    </div>
                </div>
                
                <!-- Footer -->
                <div class="game-footer">
                    powered by Krym_rampo & SopraSteria team
                </div>
            </div>
        </div>

        <!-- GAME OVER SCREEN -->
        <div id="game-over-screen" class="screen">
            <div class="game-over-container">
                <h2>üèÜ Partita Terminata!</h2>
                <div id="final-standings" class="standings">
                    <!-- Final standings -->
                </div>
                <div class="game-over-actions">
                    <button id="btn-play-again" class="btn btn-primary hidden">üîÑ Gioca Ancora</button>
                    <button id="btn-back-lobby" class="btn btn-secondary">Torna alla Lobby</button>
                </div>
            </div>
        </div>

        <!-- Chat (visible in game + game over) -->
        <div class="game-chat collapsed hidden" id="game-chat">
            <div class="chat-header" id="chat-toggle">
                <span>üí¨ Chat <span id="chat-badge" class="chat-badge hidden">!</span></span>
                <span class="chat-toggle-icon">‚ñº</span>
            </div>
            <div class="chat-body" id="chat-body">
                <div id="chat-messages" class="chat-messages"></div>
                <div class="chat-input-area">
                    <input type="text" id="chat-input" maxlength="200" placeholder="Messaggio...">
                    <button id="btn-send-chat" class="btn btn-small">‚Üí</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Reconnection Overlay -->
    <div id="reconnect-overlay" class="reconnect-overlay hidden">
        <div class="reconnect-content">
            <div class="reconnect-spinner"></div>
            <p class="reconnect-text">Connessione persa. Riconnessione in corso‚Ä¶</p>
        </div>
    </div>

    <script src="/static/js/main.js?v=20260131a"></script>
    <script src="/static/js/auth.js?v=20260131a"></script>
    <script src="/static/js/socket_client.js?v=20260131a"></script>
    <script src="/static/js/game_ui.js?v=20260131a"></script>
    <script src="/static/js/chat.js?v=20260131a"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presina - Gioco di Carte Online</title>
    <link rel="icon" type="image/png" href="/static/img/logo.png">
    <link rel="stylesheet" href="/static/css/style.css?v=20260130d">
    <link rel="stylesheet" href="/static/css/mobile.css?v=20260130d">
    <link rel="stylesheet" href="/static/css/auth.css?v=20260130d">
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>
    <div id="app">
        <!-- HOME SCREEN -->
        <div id="home-screen" class="screen active">
            <div class="home-container">
                <div class="logo-container">
                    <img src="/static/img/logo.png" alt="Presina Logo" class="logo-img">
                </div>
                <h1 class="title">Presina</h1>
                <p class="subtitle">Il gioco di carte napoletano online</p>
                
                <!-- NOT LOGGED IN -->
                <div id="home-not-logged" class="home-auth-section">
                    <div class="auth-tabs">
                        <button class="auth-tab active" data-tab="login" onclick="AuthUI.switchTab('login')">Accedi</button>
                        <button class="auth-tab" data-tab="register" onclick="AuthUI.switchTab('register')">Registrati</button>
                    </div>
                    
                    <!-- Login Form -->
                    <div id="login-form" class="auth-form active">
                        <div class="input-group">
                            <label for="login-username">Username</label>
                            <input type="text" id="login-username" maxlength="20" placeholder="Il tuo username">
                        </div>
                        <div class="input-group">
                            <label for="login-password">Password</label>
                            <input type="password" id="login-password" placeholder="La tua password">
                        </div>
                        <button id="btn-login" class="btn btn-primary btn-large" onclick="AuthUI.login()">Accedi</button>
                        <button id="btn-guest" class="btn btn-secondary" onclick="AuthUI.guestLogin()">
                            üë§ Gioca come Ospite
                        </button>
                    </div>
                    
                    <!-- Register Form -->
                    <div id="register-form" class="auth-form">
                        <div class="input-group">
                            <label for="register-username">Username *</label>
                            <input type="text" id="register-username" maxlength="20" placeholder="Scegli un username">
                        </div>
                        <div class="input-group">
                            <label for="register-password">Password *</label>
                            <input type="password" id="register-password" placeholder="Minimo 4 caratteri">
                        </div>
                        <div class="input-group">
                            <label for="register-display-name">Nome visualizzato</label>
                            <input type="text" id="register-display-name" maxlength="20" placeholder="Come ti chiami?">
                        </div>
                        <button id="btn-register" class="btn btn-primary btn-large" onclick="AuthUI.register()">Crea Account</button>
                    </div>
                </div>
                
                <!-- LOGGED IN -->
                <div id="home-logged" class="home-auth-section hidden">
                    <div class="user-welcome">
                        <img src="/static/img/default-avatar.png" alt="Avatar" class="user-avatar-large" id="user-avatar-img">
                        <h3 id="user-display-name">Benvenuto!</h3>
                        <p id="user-username">@username</p>
                    </div>
                    
                    <div class="button-group">
                        <button id="btn-enter-lobby-logged" class="btn btn-primary btn-large" onclick="AuthUI.enterLobby()">üéÆ Gioca</button>
                        <button id="btn-profile" class="btn btn-secondary" onclick="showScreen('profile')">üìä Profilo</button>
                        <button id="btn-rules-logged" class="btn btn-secondary" onclick="showScreen('rules')">üìñ Regole</button>
                        <button id="btn-logout" class="btn btn-secondary" onclick="AuthUI.logout()">üö™ Esci</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- RULES SCREEN -->
        <div id="rules-screen" class="screen">
            <div class="rules-container">
                <h2>üìñ Regole di Presina</h2>
                <div class="rules-content">
                    <h3>Obiettivo</h3>
                    <p>Indovinare quante mani vincerai in ogni turno. Chi indovina non perde vite, chi sbaglia perde 1 vita.</p>
                    
                    <h3>Setup</h3>
                    <ul>
                        <li>2-8 giocatori, ognuno parte con 5 vite</li>
                        <li>Si giocano 5 turni con 5, 4, 3, 2, 1 carte</li>
                        <li>Mazzo: 40 carte napoletane (Bastoni, Spade, Coppe, Ori)</li>
                    </ul>
                    
                    <h3>Forza delle carte</h3>
                    <p>Ordine semi: Bastoni &lt; Spade &lt; Coppe &lt; Ori</p>
                    <p>Ordine valori: Asso &lt; 2 &lt; ... &lt; 7 &lt; Fante &lt; Cavallo &lt; Re</p>
                    
                    <h3>Turno Speciale (1 carta)</h3>
                    <p>Nel turno con 1 carta, vedi le carte degli altri ma NON la tua!</p>
                    <p>Se nel turno da 1 carta nessuno sbaglia, il turno si ripete finch√© qualcuno sbaglia.</p>
                    
                    <h3>Puntata</h3>
                    <p>L'ultimo giocatore a puntare NON pu√≤ scegliere il numero che renderebbe la somma totale uguale alle carte in gioco.</p>
                    <p>Eccezione: nel turno da 1 carta la somma pu√≤ essere uguale alle carte (1).</p>
                    
                    <h3>Il Jolly (Asso di Ori)</h3>
                    <ul>
                        <li><strong>Prende:</strong> diventa la carta pi√π forte (sopra il Re di Ori)</li>
                        <li><strong>Lascia:</strong> diventa la carta pi√π debole (sotto l'Asso di Bastoni)</li>
                    </ul>
                    
                    <h3>Vittoria</h3>
                    <p>Dopo il turno da 1 carta (ripetuto finch√© qualcuno sbaglia), vince chi ha pi√π vite!</p>
                </div>
                <button id="btn-back-home" class="btn btn-secondary" onclick="showScreen('home')">‚Üê Torna alla Home</button>
            </div>
        </div>

        <!-- LOBBY SCREEN -->
        <div id="lobby-screen" class="screen">
            <div class="lobby-container">
                <div class="lobby-header">
                    <h2>üè† Lobby</h2>
                    <span id="player-name-display" class="player-badge"></span>
                </div>
                
                <!-- Hidden input for player name compatibility -->
                <input type="hidden" id="player-name" value="">
                
                <div id="existing-room-banner" class="banner hidden">
                    <span>Sei gi√† in una stanza!</span>
                    <div class="banner-actions">
                        <button id="btn-rejoin" class="btn btn-small">Rientra</button>
                        <button id="btn-abandon" class="btn btn-small btn-secondary">Abbandona</button>
                    </div>
                </div>
                
                <div class="lobby-actions">
                    <div class="search-box">
                        <input type="text" id="room-search" placeholder="Cerca stanza...">
                        <button id="btn-search" class="btn btn-small">üîç</button>
                    </div>
                    <button id="btn-create-room" class="btn btn-primary">+ Crea Stanza</button>
                </div>
                
                <div id="rooms-list" class="rooms-list">
                    <p class="empty-message">Nessuna stanza disponibile. Creane una!</p>
                </div>
                
                <button id="btn-back-home-lobby" class="btn btn-secondary">‚Üê Torna alla Home</button>
            </div>
            
            <!-- Create Room Modal -->
            <div id="create-room-modal" class="modal hidden">
                <div class="modal-content">
                    <h3>Crea Nuova Stanza</h3>
                    <div class="input-group">
                        <label for="room-name">Nome stanza:</label>
                        <input type="text" id="room-name" maxlength="30" placeholder="Nome della stanza...">
                    </div>
                    <div class="input-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="room-private-check">
                            <span>üîí Stanza privata (richiede codice)</span>
                        </label>
                    </div>
                    <div id="room-code-group" class="input-group hidden">
                        <label for="room-access-code">Codice di accesso:</label>
                        <input type="text" id="room-access-code" maxlength="10" placeholder="Inserisci un codice...">
                        <p class="hint-text">Condividi questo codice solo con chi vuoi invitare</p>
                    </div>
                    <div class="button-group">
                        <button id="btn-confirm-create" class="btn btn-primary">Crea</button>
                        <button id="btn-cancel-create" class="btn btn-secondary">Annulla</button>
                    </div>
                </div>
            </div>
            
            <!-- Join Private Room Modal -->
            <div id="join-private-modal" class="modal hidden">
                <div class="modal-content">
                    <h3>üîí Stanza Privata</h3>
                    <p>Questa stanza richiede un codice di accesso.</p>
                    <div class="input-group">
                        <label for="join-access-code">Codice:</label>
                        <input type="text" id="join-access-code" maxlength="10" placeholder="Inserisci il codice...">
                    </div>
                    <div class="button-group">
                        <button id="btn-confirm-join-private" class="btn btn-primary">Entra</button>
                        <button id="btn-cancel-join-private" class="btn btn-secondary">Annulla</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- WAITING ROOM SCREEN -->
        <div id="waiting-room-screen" class="screen">
            <div class="waiting-container">
                <div class="room-header">
                    <h2 id="room-title">Stanza</h2>
                    <span id="room-status" class="status-badge">In attesa</span>
                </div>
                
                <div id="waiting-players" class="players-grid">
                    <!-- Players will be rendered here -->
                </div>
                
                <div id="admin-controls" class="admin-controls hidden">
                    <button id="btn-start-game" class="btn btn-primary btn-large">‚ñ∂ Avvia Partita</button>
                    <p class="hint">Servono almeno 2 giocatori</p>
                    <div id="room-code-display" class="room-code-display hidden">
                        <span>üîí Codice: <strong id="display-access-code"></strong></span>
                        <p class="hint">Condividi questo codice per invitare</p>
                    </div>
                </div>
                
                <div class="waiting-actions">
                    <button id="btn-leave-room" class="btn btn-secondary">üö™ Abbandona</button>
                </div>
                
                <!-- Chat in waiting room -->
                <div class="waiting-chat">
                    <div id="waiting-chat-messages" class="chat-messages"></div>
                    <div class="chat-input-area">
                        <input type="text" id="waiting-chat-input" maxlength="200" placeholder="Scrivi un messaggio...">
                        <button id="btn-send-waiting-chat" class="btn btn-small">Invia</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- GAME SCREEN -->
        <div id="game-screen" class="screen">
            <div class="game-container">
                <!-- Header -->
                <div class="game-header">
                    <div class="turn-info">
                        <span id="turn-number">Turno 1/5</span>
                        <span id="cards-info">5 carte</span>
                        <span id="trick-info" class="trick-info-header">Mano 1/5</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div id="phase-indicator" class="phase-indicator">Puntate</div>
                        <!-- Mobile Menu Button -->
                        <button id="mobile-menu-btn" class="mobile-menu-btn mobile-only" onclick="MobileUI.toggleMenu()">
                            ‚ò∞
                        </button>
                    </div>
                </div>
                
                <!-- Mobile Spectator Banner -->
                <div id="mobile-spectator-banner" class="mobile-spectator-banner mobile-only hidden">
                    üëÅÔ∏è Sei spettatore. Giocherai dal prossimo turno.
                </div>
                
                <!-- Mobile Special Turn Note -->
                <div id="mobile-special-note" class="mobile-special-note mobile-only hidden">
                    ‚ö†Ô∏è Turno speciale: vedi le carte degli altri, non le tue!
                </div>
                
                <!-- Spectator/Join Banner -->
                <div id="spectator-banner" class="banner hidden">
                    <span>üëÅÔ∏è Sei spettatore. Giocherai dal prossimo turno.</span>
                </div>
                
                <!-- Main Game Area -->
                <div class="game-main">
                    <!-- Left Panel: Hand & Betting -->
                    <div class="hand-panel">
                        <h3>Le tue carte</h3>
                        <div id="player-hand" class="hand-area">
                            <!-- Cards will be rendered here -->
                        </div>
                        
                        <!-- Betting Area (moved here) -->
                        <div id="betting-area" class="betting-area hidden">
                            <h4>Fai la tua puntata</h4>
                            <div id="bet-buttons" class="bet-buttons">
                                <!-- Bet buttons rendered by JS -->
                            </div>
                            <p id="forbidden-bet-note" class="forbidden-note hidden"></p>
                        </div>
                        
                        <!-- Bets Summary (visible during betting phase) -->
                        <div id="bets-summary" class="bets-summary hidden">
                            <h4>Puntate</h4>
                            <div id="bets-list" class="bets-list">
                                <!-- Bets rendered here -->
                            </div>
                        </div>
                        
                        <div id="special-turn-note" class="special-note hidden">
                            ‚ö†Ô∏è Turno speciale: vedi le carte degli altri, non le tue!
                        </div>
                        <div id="others-cards" class="others-cards hidden">
                            <!-- Other players' cards in special turn -->
                        </div>
                    </div>
                    
                    <!-- Center: Table -->
                    <div class="table-area">
                        <div id="table-center" class="table-center">
                            <div id="played-cards" class="played-cards">
                                <!-- Played cards go here -->
                            </div>
                        </div>
                        
                        <!-- Player positions around table -->
                        <div id="table-positions" class="table-positions">
                            <!-- 8 player slots rendered by JS -->
                        </div>
                    </div>
                    
                    <!-- Right Panel: Players Info -->
                    <div class="players-panel">
                        <h3>Giocatori</h3>
                        <div id="players-info" class="players-info">
                            <!-- Player info cards -->
                        </div>
                    </div>
                </div>
                
                <!-- Table Bets Overlay (visible during betting phase) -->
                <div id="table-bets-overlay" class="table-bets-overlay hidden">
                    <h3>Puntate in corso...</h3>
                    <div id="table-bets-list" class="table-bets-list">
                        <!-- Bets displayed here -->
                    </div>
                </div>
                
                <!-- Jolly Choice -->
                <div id="jolly-choice" class="jolly-choice hidden">
                    <h3>üÉè Hai giocato l'Asso di Ori!</h3>
                    <p>Scegli come usarlo:</p>
                    <div class="jolly-buttons">
                        <button id="btn-jolly-prende" class="btn btn-primary">üí™ Prende (Pi√π Forte)</button>
                        <button id="btn-jolly-lascia" class="btn btn-secondary">ü™∂ Lascia (Pi√π Debole)</button>
                    </div>
                </div>
                
                <!-- Trick Winner Popup -->
                <div id="trick-winner-overlay" class="trick-winner-overlay hidden"></div>
                <div id="trick-winner-popup" class="trick-winner-popup hidden">
                    <div class="trick-winner-content">
                        <div class="trick-winner-icon">üèÜ</div>
                        <h3>Mano Vinta!</h3>
                        <p id="trick-winner-name">Giocatore</p>
                        <p id="trick-winner-card" class="trick-winner-card">con la carta</p>
                    </div>
                </div>
                
                <!-- Turn Results -->
                <div id="turn-results" class="turn-results hidden">
                    <h3>Risultati del Turno</h3>
                    <div class="results-table-wrap">
                        <table class="results-table" aria-label="Risultati del turno">
                            <thead>
                                <tr>
                                    <th class="col-name">Giocatore</th>
                                    <th class="col-bet">Puntata</th>
                                    <th class="col-won">Prese</th>
                                    <th class="col-result">Esito</th>
                                    <th class="col-lives">Vite</th>
                                </tr>
                            </thead>
                            <tbody id="results-list"></tbody>
                        </table>
                    </div>
                    <button id="btn-next-turn" class="btn btn-primary">Prossimo Turno</button>
                    <div id="ready-count" class="ready-count">Pronti: 0/0</div>
                </div>
                
                <!-- Card Confirm Popup -->
                <div id="card-confirm-overlay" class="card-confirm-overlay hidden"></div>
                <div id="card-confirm" class="card-confirm hidden">
                    <p>Conferma carta: <span id="selected-card-name"></span></p>
                    <div class="button-group">
                        <button id="btn-confirm-card" class="btn btn-primary">‚úì Gioca</button>
                        <button id="btn-cancel-card" class="btn btn-secondary">‚úó Annulla</button>
                    </div>
                </div>
                
                <!-- Footer -->
                <div class="game-footer desktop-only">
                    powered by Krym_rampo & SopraSteria team
                </div>
                
                <!-- ==================== MOBILE UI ELEMENTS ==================== -->
                
                <!-- Mobile Player Bar -->
                <div id="mobile-player-bar" class="mobile-player-bar mobile-only">
                    <div class="mobile-player-info">
                        <div class="mobile-player-avatar">üë§</div>
                        <div class="mobile-player-details">
                            <div id="mobile-player-name" class="mobile-player-name">Tu</div>
                            <div class="mobile-player-stats">
                                <span>‚ù§Ô∏è <span id="mobile-player-lives">5</span></span>
                                <span>üéØ <span id="mobile-player-bet">-</span></span>
                                <span>üèÜ <span id="mobile-player-tricks">0</span></span>
                            </div>
                        </div>
                    </div>
                    <div id="mobile-quick-actions" class="mobile-quick-actions">
                        <!-- Dynamically populated -->
                    </div>
                </div>
                
                <!-- Mobile Hand - Horizontal Scroll -->
                <div id="mobile-hand-container" class="mobile-hand-container mobile-only">
                    <div class="mobile-hand-title">
                        <span>Le tue carte</span>
                        <span id="mobile-cards-count">0 carte</span>
                    </div>
                    <div id="mobile-hand" class="mobile-hand">
                        <!-- Cards rendered here -->
                    </div>
                </div>
                
                <!-- Mobile Bottom Tab Bar -->
                <div class="mobile-tab-bar mobile-only">
                    <button class="mobile-tab-btn active" data-tab="game" onclick="MobileUI.switchTab('game')">
                        <span class="icon">üÉè</span>
                        <span>Gioco</span>
                    </button>
                    <button class="mobile-tab-btn" data-tab="players" onclick="MobileUI.openPlayersSheet()">
                        <span class="icon">üë•</span>
                        <span>Giocatori</span>
                        <span id="mobile-players-badge" class="mobile-tab-badge hidden">!</span>
                    </button>
                    <button class="mobile-tab-btn" data-tab="chat" onclick="MobileUI.openChatSheet()">
                        <span class="icon">üí¨</span>
                        <span>Chat</span>
                        <span id="mobile-chat-badge" class="mobile-tab-badge hidden">!</span>
                    </button>
                    <button id="mobile-bet-tab-btn" class="mobile-tab-btn" data-tab="bet" onclick="MobileUI.openBettingSheet()">
                        <span class="icon">üéØ</span>
                        <span>Punta</span>
                    </button>
                </div>
                
                <!-- ==================== MOBILE SHEETS (Bottom Drawers) ==================== -->
                
                <!-- Players Sheet -->
                <div id="mobile-players-sheet-overlay" class="mobile-sheet-overlay mobile-only" onclick="MobileUI.closeSheets()"></div>
                <div id="mobile-players-sheet" class="mobile-sheet mobile-only">
                    <div class="mobile-sheet-handle"></div>
                    <div class="mobile-sheet-header">
                        <span class="mobile-sheet-title">üë• Giocatori</span>
                        <button class="mobile-sheet-close" onclick="MobileUI.closeSheets()">‚úï</button>
                    </div>
                    <div id="mobile-players-sheet-content" class="mobile-sheet-content">
                        <div class="mobile-players-list">
                            <!-- Players rendered here -->
                        </div>
                    </div>
                </div>
                
                <!-- Chat Sheet -->
                <div id="mobile-chat-sheet-overlay" class="mobile-sheet-overlay mobile-only" onclick="MobileUI.closeSheets()"></div>
                <div id="mobile-chat-sheet" class="mobile-sheet mobile-only">
                    <div class="mobile-sheet-handle"></div>
                    <div class="mobile-sheet-header">
                        <span class="mobile-sheet-title">üí¨ Chat</span>
                        <button class="mobile-sheet-close" onclick="MobileUI.closeSheets()">‚úï</button>
                    </div>
                    <div id="mobile-chat-sheet-content" class="mobile-sheet-content">
                        <div id="mobile-chat-messages" class="mobile-chat-messages">
                            <!-- Messages rendered here -->
                        </div>
                    </div>
                    <div class="mobile-chat-input-area">
                        <input type="text" id="mobile-chat-input" maxlength="200" placeholder="Scrivi un messaggio...">
                        <button class="mobile-chat-send-btn" onclick="MobileUI.sendChatMessage()">‚Üí</button>
                    </div>
                </div>
                
                <!-- Betting Sheet -->
                <div id="mobile-betting-sheet-overlay" class="mobile-sheet-overlay mobile-only" onclick="MobileUI.closeSheets()"></div>
                <div id="mobile-betting-sheet" class="mobile-sheet mobile-only">
                    <div class="mobile-sheet-handle"></div>
                    <div class="mobile-sheet-header">
                        <span class="mobile-sheet-title">üéØ Fai la tua puntata</span>
                        <button class="mobile-sheet-close" onclick="MobileUI.closeSheets()">‚úï</button>
                    </div>
                    <div class="mobile-sheet-content mobile-betting-content">
                        <h4>Scegli quante mani pensi di vincere</h4>
                        <div id="mobile-bet-grid" class="mobile-bet-grid">
                            <!-- Bet buttons rendered here -->
                        </div>
                        <div id="mobile-bet-forbidden-note" class="mobile-bet-forbidden-note hidden"></div>
                    </div>
                </div>
                
                <!-- ==================== MOBILE POPUPS ==================== -->
                
                <!-- Mobile Card Confirm -->
                <div id="mobile-card-confirm" class="mobile-card-confirm mobile-only hidden">
                    <img id="mobile-card-confirm-img" class="mobile-card-confirm-card" src="" alt="">
                    <p class="mobile-card-confirm-text">Giocare questa carta?</p>
                    <div class="mobile-card-confirm-actions">
                        <button class="btn btn-secondary" onclick="MobileUI.cancelCard()">Annulla</button>
                        <button class="btn btn-primary" onclick="MobileUI.confirmCard()">‚úì Gioca</button>
                    </div>
                </div>
                
                <!-- Mobile Jolly Choice -->
                <div id="mobile-jolly-choice" class="mobile-jolly-overlay mobile-only hidden">
                    <div class="mobile-jolly-title">üÉè Asso di Ori!</div>
                    <div class="mobile-jolly-subtitle">Scegli come usarlo</div>
                    <div class="mobile-jolly-buttons">
                        <button class="mobile-jolly-btn prende" onclick="MobileUI.chooseJolly('prende')">
                            üí™ Prende (Pi√π Forte)
                        </button>
                        <button class="mobile-jolly-btn lascia" onclick="MobileUI.chooseJolly('lascia')">
                            ü™∂ Lascia (Pi√π Debole)
                        </button>
                    </div>
                </div>
                
                <!-- Mobile Trick Winner Popup -->
                <div id="mobile-trick-popup" class="mobile-trick-popup mobile-only">
                    <div class="mobile-trick-popup-icon">üèÜ</div>
                    <div id="mobile-trick-popup-title" class="mobile-trick-popup-title">Mano Vinta!</div>
                    <div id="mobile-trick-popup-card" class="mobile-trick-popup-card"></div>
                </div>
                
                <!-- Mobile Turn Results -->
                <div id="mobile-turn-results" class="mobile-turn-results mobile-only">
                    <div class="mobile-turn-results-header">
                        <h3>üìä Risultati del Turno</h3>
                    </div>
                    <div id="mobile-turn-results-content" class="mobile-turn-results-content">
                        <!-- Results rendered here -->
                    </div>
                    <div class="mobile-turn-results-footer">
                        <button id="mobile-btn-next-turn" class="btn btn-primary btn-large" style="width: 100%;">
                            Prossimo Turno
                        </button>
                        <div id="mobile-ready-count" class="ready-count" style="text-align: center; margin-top: 10px;">
                            Pronti: 0/0
                        </div>
                    </div>
                </div>
                
            </div>
        </div>

        <!-- GAME OVER SCREEN -->
        <div id="game-over-screen" class="screen">
            <div class="game-over-container">
                <h2>üèÜ Partita Terminata!</h2>
                <div id="final-standings" class="standings">
                    <!-- Final standings -->
                </div>
                <button id="btn-back-lobby" class="btn btn-primary">Torna alla Lobby</button>
            </div>
        </div>

        <!-- PROFILE SCREEN -->
        <div id="profile-screen" class="screen">
            <div class="profile-container">
                <div class="profile-header">
                    <button class="btn-back" onclick="showScreen('home')">‚Üê</button>
                    <h2>üë§ Profilo</h2>
                </div>
                
                <div class="profile-card">
                    <div class="profile-avatar-container">
                        <img src="/static/img/default-avatar.png" alt="Avatar" class="profile-avatar-img" id="profile-avatar-img">
                        <label for="avatar-upload" class="avatar-upload-btn" title="Cambia foto">
                            üì∑
                        </label>
                        <input type="file" id="avatar-upload" accept="image/*" style="display: none;" onchange="AuthUI.uploadAvatar(this)">
                    </div>
                    <h3 id="profile-display-name">Nome Utente</h3>
                    <p id="profile-username">@username</p>
                    <span id="profile-member-since" class="member-since">Membro dal 2024</span>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-value" id="profile-stat-games">0</span>
                        <span class="stat-label">Partite Giocate</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="profile-stat-wins">0</span>
                        <span class="stat-label">Vittorie</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="profile-stat-losses">0</span>
                        <span class="stat-label">Sconfitte</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="profile-stat-winrate">0%</span>
                        <span class="stat-label">Win Rate</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="profile-stat-lives">0</span>
                        <span class="stat-label">Vite Perse</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="profile-stat-streak">0</span>
                        <span class="stat-label">Best Streak</span>
                    </div>
                </div>
                
                <div class="profile-section">
                    <h4>üìú Cronologia Partite</h4>
                    <div id="profile-game-history" class="game-history">
                        <p class="empty-message">Nessuna partita giocata</p>
                    </div>
                </div>
                
                <div class="profile-section">
                    <h4>üèÜ Classifica Globale</h4>
                    <div class="leaderboard-tabs">
                        <button class="lb-tab active" data-cat="wins" onclick="AuthUI.loadLeaderboard('wins')">Vittorie</button>
                        <button class="lb-tab" data-cat="win_rate" onclick="AuthUI.loadLeaderboard('win_rate')">Win Rate</button>
                        <button class="lb-tab" data-cat="streak" onclick="AuthUI.loadLeaderboard('streak')">Streak</button>
                    </div>
                    <div id="profile-leaderboard" class="leaderboard">
                        <!-- Leaderboard rendered here -->
                    </div>
                </div>
                
                <div class="profile-actions">
                    <button class="btn btn-secondary" onclick="showScreen('home')">‚Üê Torna alla Home</button>
                    <button class="btn btn-danger" id="profile-btn-logout" onclick="AuthUI.logout()">üö™ Esci</button>
                </div>
            </div>
        </div>

        <!-- Chat (visible in game + game over) -->
        <div class="game-chat collapsed hidden" id="game-chat">
            <div class="chat-header" id="chat-toggle">
                <span>üí¨ Chat <span id="chat-badge" class="chat-badge hidden">!</span></span>
                <span class="chat-toggle-icon">‚ñº</span>
            </div>
            <div class="chat-body" id="chat-body">
                <div id="chat-messages" class="chat-messages"></div>
                <div class="chat-input-area">
                    <input type="text" id="chat-input" maxlength="200" placeholder="Messaggio...">
                    <button id="btn-send-chat" class="btn btn-small">‚Üí</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="/static/js/main.js?v=20260130d"></script>
    <script src="/static/js/socket_client.js?v=20260130d"></script>
    <script src="/static/js/game_ui.js?v=20260130d"></script>
    <script src="/static/js/chat.js?v=20260130d"></script>
    <script src="/static/js/mobile.js?v=20260130d"></script>
    <script src="/static/js/auth.js?v=20260130d"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presina - Gioco Online</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Schermata Home -->
        <div id="home-screen" class="screen active">
            <h1>üé¥ PRESINA üé¥</h1>
            <p class="subtitle">Il gioco della puntata perfetta!</p>
            
            <div class="menu">
                <div class="input-group">
                    <label for="player-name">Il tuo nome:</label>
                    <input type="text" id="player-name" placeholder="Inserisci il tuo nome" maxlength="20">
                </div>
                
                <button class="btn btn-primary btn-large" id="enter-lobby-btn">
                    üö™ Entra nella Lobby
                </button>
                
                <button class="btn btn-info" id="show-rules-btn">
                    üìñ Regole del Gioco
                </button>
            </div>
        </div>

        <!-- Schermata Lobby (lista stanze) -->
        <div id="lobby-screen" class="screen">
            <h2>üéÆ Stanze Disponibili</h2>
            
            <div class="lobby-header">
                <div class="search-box">
                    <input type="text" id="search-room" placeholder="üîç Cerca stanza per nome...">
                </div>
                
                <button class="btn btn-success" id="create-room-btn">
                    ‚ûï Crea Nuova Stanza
                </button>
            </div>
            
            <div id="rooms-list" class="rooms-list">
                <p class="no-rooms">Nessuna stanza disponibile. Creane una!</p>
            </div>

            <div id="active-room-banner" class="active-room-banner" style="display: none;"></div>
            <button class="btn btn-secondary" id="return-to-room-btn" style="display: none;">
                ‚Ü© Torna alla tua stanza
            </button>
            
            <button class="btn btn-secondary" id="back-home-btn">
                ‚Üê Torna alla Home
            </button>
        </div>

        <!-- Modale Crea Stanza -->
        <div id="create-room-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <h3>Crea una Nuova Stanza</h3>
                
                <div class="input-group">
                    <label for="room-name">Nome della stanza:</label>
                    <input type="text" id="room-name" placeholder="Es: Partita con amici" maxlength="30">
                </div>
                
                <div class="button-group">
                    <button class="btn btn-success" id="confirm-create-btn">
                        Crea Stanza
                    </button>
                    <button class="btn btn-secondary" id="cancel-create-btn">
                        Annulla
                    </button>
                </div>
            </div>
        </div>

        <!-- Schermata Stanza (waiting room) -->
        <div id="room-screen" class="screen">
            <h2 id="room-title">Stanza</h2>
            
            <div class="room-info">
                <p>Giocatori in attesa:</p>
            </div>
            
            <div class="players-waiting">
                <ul id="players-list"></ul>
            </div>
            
            <div id="admin-controls" style="display: none;">
                <button class="btn btn-success btn-large" id="start-game-btn">
                    üöÄ INIZIA PARTITA
                </button>
                <p class="hint">Minimo 2 giocatori per iniziare</p>
            </div>
            
            <p id="waiting-message" class="waiting-text">In attesa che l'admin avvii la partita...</p>
            
            <button class="btn btn-secondary" id="back-to-lobby-room-btn">
                ‚Üê Torna alla Lobby
            </button>

            <button class="btn btn-danger" id="leave-room-btn">
                üö™ Abbandona
            </button>
        </div>

        <!-- Schermata Gioco -->
        <div id="game-screen" class="screen">
            <div class="game-header compact">
                <div class="round-phase-bar">
                    <div class="round-info">
                        <h3>Turno <span id="current-round">1</span>/5</h3>
                        <p><span id="cards-this-round">5</span> carte</p>
                    </div>
                    <div class="game-phase compact">
                        <h3 id="phase-title">Fase di Puntata</h3>
                        <p id="phase-description"></p>
                    </div>
                </div>
            </div>

            <div id="spectator-banner" class="spectator-banner" style="display: none;"></div>

            <div class="game-layout">
                <!-- Area Mano del Giocatore -->
                <div id="hand-area" class="hand-area">
                    <h4>Le tue carte:</h4>
                    <div id="player-hand" class="cards-container"></div>
                    <div id="card-confirmation" class="card-confirmation" style="display: none;">
                        <span id="selected-card-label"></span>
                        <button class="btn btn-success" id="confirm-card-btn">
                            ‚úÖ Conferma
                        </button>
                        <button class="btn btn-secondary" id="cancel-card-btn">
                            ‚úñ Annulla
                        </button>
                    </div>
                    <p id="special-round-note" class="special-note" style="display: none;">
                        üé≠ Turno speciale: Questa √® la tua carta, ma non puoi vederla!
                    </p>
                    <div id="other-players-cards" class="other-players-cards"></div>
                </div>

                <div class="game-main">
                    <!-- Tavolo di gioco -->
                    <div class="table-area">
                        <div class="table-surface">
                            <div class="table-ring">
                                <div class="table-seat" data-seat="0"></div>
                                <div class="table-seat" data-seat="1"></div>
                                <div class="table-seat" data-seat="2"></div>
                                <div class="table-seat" data-seat="3"></div>
                                <div class="table-seat" data-seat="4"></div>
                                <div class="table-seat" data-seat="5"></div>
                                <div class="table-seat" data-seat="6"></div>
                                <div class="table-seat" data-seat="7"></div>
                            </div>
                            <div class="table-center">
                                <div id="trick-area" class="trick-area table-trick" style="display: none;">
                                    <div class="trick-info">
                                        Mano <span id="trick-number">1</span>/<span id="total-tricks">5</span>
                                    </div>
                                    <div id="cards-played" class="cards-played"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Area Puntata -->
                    <div id="betting-area" class="betting-area" style="display: none;">
                        <p id="bet-instruction"></p>
                        <div class="bet-buttons" id="bet-buttons"></div>
                    </div>
                </div>
            </div>

            <!-- Modale Jolly -->
            <div id="joker-modal" class="modal" style="display: none;">
                <div class="modal-content">
                    <h3>Asso di Denari - Jolly!</h3>
                    <p>Scegli come giocare il jolly:</p>
                    <div class="button-group">
                        <button class="btn btn-success" id="joker-prende-btn">
                            üîù PRENDE<br>
                            <small>(Pi√π del Re di Denari)</small>
                        </button>
                        <button class="btn btn-danger" id="joker-lascia-btn">
                            ‚¨áÔ∏è LASCIA<br>
                            <small>(Meno dell'Asso di Bastoni)</small>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Pulsante Fine Turno -->
            <div id="next-round-panel" class="next-round-panel" style="display: none;">
                <button class="btn btn-success" id="next-round-btn">
                    Prossimo turno
                </button>
                <p id="next-round-status" class="next-round-status"></p>
            </div>

            <!-- Messaggi di Gioco -->
            <div id="game-messages" class="game-messages"></div>

            <!-- Pannello Stato Giocatori -->
            <div id="player-panel" class="player-panel">
                <div class="player-panel-header">
                    <span>Giocatori</span>
                </div>
                <div id="players-status" class="players-status-panel"></div>
                <div id="spectator-info" class="spectator-info" style="display: none;">
                    üëÄ Spettatori: <span id="spectator-count">0</span>
                </div>
            </div>

            <!-- Chat di Gioco -->
            <div id="chat-wrapper" class="chat-wrapper">
                <div id="chat-panel" class="chat-panel">
                    <div class="chat-header">
                        <span>üí¨ Chat di Gioco</span>
                        <button class="chat-toggle" id="chat-toggle-btn" type="button" aria-expanded="true">
                            Riduci
                        </button>
                    </div>
                    <div class="chat-body">
                        <div id="chat-messages" class="chat-messages"></div>
                        <div class="chat-input">
                            <input type="text" id="chat-input" placeholder="Scrivi un messaggio..." maxlength="200">
                            <button class="btn btn-primary" id="chat-send-btn">Invia</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modale Partita Iniziata -->
        <div id="join-started-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <h3>Partita gi√† iniziata</h3>
                <p>Scegli come entrare nella partita.</p>
                <p><strong>Entra dal prossimo turno:</strong> avrai vite pari al giocatore con meno vite.</p>
                <div class="button-group">
                    <button class="btn btn-success" id="join-as-player-btn">
                        Entra dal prossimo turno
                    </button>
                    <button class="btn btn-info" id="join-as-spectator-btn">
                        Spettatore (solo chat)
                    </button>
                </div>
                <button class="btn btn-secondary" id="cancel-join-started-btn">
                    Annulla
                </button>
            </div>
        </div>

        <!-- Schermata Regole -->
        <div id="rules-screen" class="screen">
            <h2>üìñ Regole del Gioco</h2>
            <div class="rules-content">
                <h3>Obiettivo</h3>
                <p>Sopravvivere con il maggior numero di vite attraverso 5 turni di gioco.</p>

                <h3>Setup</h3>
                <ul>
                    <li>Da 2 a 8 giocatori</li>
                    <li>Ogni giocatore inizia con 5 vite</li>
                    <li>Mazzo di carte da briscola (40 carte)</li>
                </ul>

                <h3>Turni</h3>
                <ul>
                    <li>Turno 1: 5 carte</li>
                    <li>Turno 2: 4 carte</li>
                    <li>Turno 3: 3 carte</li>
                    <li>Turno 4: 2 carte</li>
                    <li>Turno 5: 1 carta (speciale - vedi le carte altrui ma non la tua!)</li>
                </ul>

                <h3>Ordine delle Carte</h3>
                <p>Dalla pi√π debole alla pi√π forte:</p>
                <p><strong>Bastoni</strong> ‚Üí <strong>Spade</strong> ‚Üí <strong>Coppe</strong> ‚Üí <strong>Denari</strong></p>
                <p>Asso < 2 < 3 < 4 < 5 < 6 < 7 < Fante < Cavallo < Re</p>

                <h3>Fase di Puntata</h3>
                <ul>
                    <li>Ogni giocatore punta quante mani riuscir√† a vincere nel turno</li>
                    <li>‚ö†Ô∏è L'ultimo giocatore NON pu√≤ dire un numero che faccia tornare i conti!</li>
                </ul>

                <h3>Jolly - Asso di Denari</h3>
                <p>Quando giochi l'Asso di Denari puoi scegliere:</p>
                <ul>
                    <li><strong>PRENDE</strong>: Vale pi√π del Re di Denari (carta pi√π forte)</li>
                    <li><strong>LASCIA</strong>: Vale meno dell'Asso di Bastoni (carta pi√π debole)</li>
                </ul>

                <h3>Fine Turno</h3>
                <ul>
                    <li>‚úÖ Se indovini esattamente quante mani prendi: mantieni le vite</li>
                    <li>‚ùå Se sbagli: perdi 1 vita</li>
                </ul>

                <h3>Vincitore</h3>
                <p>Chi ha pi√π vite alla fine dei 5 turni vince!</p>
            </div>
            
            <button class="btn btn-secondary" id="back-from-rules-btn">
                ‚Üê Indietro
            </button>
        </div>

        <!-- Schermata Finale -->
        <div id="final-screen" class="screen">
            <h2>üèÜ Classifica Finale</h2>
            <p id="final-summary" class="final-summary"></p>
            <div class="final-standings">
                <ol id="final-standings"></ol>
            </div>
            <button class="btn btn-secondary" id="back-to-lobby-final-btn">
                ‚Üê Torna alla Lobby
            </button>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <script src="{{ url_for('static', filename='game.js') }}"></script>
</body>
</html>
